@{
    ViewBag.Title = "Post a space";
    ViewBag.PageName = "myspace";
    Layout = "~/Views/Shared/_LayoutMaterialAdmin.cshtml";
    ViewBag.MenuPropertyOwnerClass = "active";

}

@section CSS{
    <link href="/Content/css/datepicker.css" rel="stylesheet" />
}

<style type="text/css">
    #map-canvas {
        height: 200px;
        width: 100% margin: 0;
        padding: 0;
    }
</style>

<div class="card col-md-6">
    <div class="row">
        <div class="col-md-12">
            <div class="card-head">
                <header>Post a carpark</header>
            </div>
            <!--end .card-head -->
            <div class="card-body">



                <div class="row">
                    <div class="col-md-12 pull-left">
                        <div id="contact" class="form-container">
                            <fieldset>
                                <div id="message"></div>
                                <div class="alert alert-success" role="alert" style="display:none;">We have received your parking space details. We'll send you a post shortly to confirm you address.</div>
                                <div class="alert alert-danger" role="alert" style="display:none;">Please input address.</div>
                                <form method="post" action="js/contact-form.php" name="contactform" id="contactform">
                                    <div class="form-group">
                                        <label>Carpark space address</label>
                                        <input id="autocomplete" type="text" value="" placeholder="Address (Required)" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>Photo</label>
                                        <input id="filePhoto" type="file" value="" placeholder="Photo of the carpark space" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label>Vehicle Type</label>
                                        <select id="drpVehicleType" class="form-control">
                                            <option value="Car">Car</option>
                                            <option value="Motorcycle">Motocycle</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Number of slot available</label>
                                        <select id="drpNumberOfSlot" class="form-control">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Availability Type</label>
                                        <select id="drpAvailabilityType" class="form-control">
                                            <option value="Date Range">Date Range</option>
                                            <option value="Specific Date">Specific Date</option>
                                            <option value="Specific Day">Specific Day</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Availability Date From</label>
                                        <input class="form-control" type="text" id="DateFrom">
                                    </div>
                                    <div class="form-group">
                                        <label>Availability Date To</label>
                                        <input class="form-control" type="text" id="DateTo">
                                    </div>
                                    <div class="form-group" style="display:none;">
                                        <label>Availability Date</label>
                                        <input class="form-control" type="text" id="AvailabilityDate">
                                    </div>
                                    <div class="form-group" id="specific-day-fields" style="display:none;">
                                        <label>Specific Day</label>
                                        <div class="form-inline">
                                            <div class="checkbox">
                                                <input id="Sun" type="checkbox" value="true">
                                                <label>Sun</label>
                                            </div>
                                            &nbsp;&nbsp;
                                            <div class="checkbox">
                                                <input id="Mon" type="checkbox" value="true">
                                                <label>Mon</label>
                                            </div>
                                            &nbsp;&nbsp;
                                            <div class="checkbox">
                                                <input id="Tue" type="checkbox" value="true">
                                                <label>Tue</label>
                                            </div>
                                            &nbsp;&nbsp;
                                            <div class="checkbox">
                                                <input id="Wed" type="checkbox" value="true">
                                                <label>Wed</label>
                                            </div>
                                            &nbsp;&nbsp;
                                            <div class="checkbox">
                                                <input id="Thu" type="checkbox" value="true">
                                                <label>Thu</label>
                                            </div>
                                            &nbsp;&nbsp;
                                            <div class="checkbox">
                                                <input id="Fri" type="checkbox" value="true">
                                                <label>Fri</label>
                                            </div>
                                            &nbsp;&nbsp;
                                            <div class="checkbox">
                                                <input id="Sat" type="checkbox" value="true">
                                                <label>Sat</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Time from</label>
                                        <select id="drpTimeFrom" class="form-control">
                                            @for (var i = 1; i <= 12; i++)
                                            {
                                                <option value="@i:00 AM">@i:00 AM</option>
                                                <option value="@i:15 AM">@i:15 AM</option>
                                                <option value="@i:30 AM">@i:30 AM</option>
                                                <option value="@i:45 AM">@i:45 AM</option>
                                            }
                                            @for (var i = 1; i <= 12; i++)
                                            {
                                                <option value="@i:00 PM">@i:00 PM</option>
                                                <option value="@i:15 PM">@i:15 PM</option>
                                                <option value="@i:30 PM">@i:30 PM</option>
                                                <option value="@i:45 PM">@i:45 PM</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Time To</label>
                                        <select id="drpTimeTo" class="form-control">
                                            @for (var i = 1; i <= 12; i++)
                                            {
                                                <option value="@i:00 AM">@i:00 AM</option>
                                                <option value="@i:15 AM">@i:15 AM</option>
                                                <option value="@i:30 AM">@i:30 AM</option>
                                                <option value="@i:45 AM">@i:45 AM</option>
                                            }
                                            @for (var i = 1; i <= 12; i++)
                                            {
                                                <option value="@i:00 PM">@i:00 PM</option>
                                                <option value="@i:15 PM">@i:15 PM</option>
                                                <option value="@i:30 PM">@i:30 PM</option>
                                                <option value="@i:45 PM">@i:45 PM</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Price</label>
                                        <input id="price" type="text" value="" placeholder="price per hour" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <textarea id="instructions" class="form-control" rows="3" placeholder="Instruction to get there"></textarea>
                                        <div class="editContent">
                                            <p class="small text-muted"><span class="guardsman">* Once the address has been submitted, we need to verify the actual address before we can post the space.</span> </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <button class="btn btn-primary" type="button" id="cf-submit">Submit</button>
                                    </div>
                                    <input type="hidden" id="long" />
                                    <input type="hidden" id="lat" />
                                </form>
                            </fieldset>
                        </div><!-- /.form-container -->

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



                    @section Scripts {
                        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
                        <script src="https://maps.googleapis.com/maps/api/js?signed_in=true&libraries=places&callback=initAutocomplete"
                                async defer></script>


                        <script src="/Content/js/bootstrap-datepicker.js"></script>
                        <script type="text/javascript">
                            $('#DateFrom').datepicker({ format: 'yyyy-mm-dd' });
                            $('#DateTo').datepicker({ format: 'yyyy-mm-dd' });
                            $('#AvailabilityDate').datepicker({ format: 'yyyy-mm-dd' });

                            $("#drpAvailabilityType").change(function () {
                                switch ($("#drpAvailabilityType").val()) {
                                    case "Specific Date":
                                        $('#DateFrom').parent().hide();
                                        $('#DateTo').parent().hide();
                                        $("#AvailabilityDate").parent().show();
                                        $("#specific-day-fields").hide();
                                        break;
                                    case "Date Range":
                                        $('#DateFrom').parent().show();
                                        $('#DateTo').parent().show();
                                        $("#AvailabilityDate").parent().hide();
                                        $("#specific-day-fields").hide();
                                        break;
                                    case "Specific Day":
                                        $("#specific-day-fields").show();
                                        $('#DateFrom').parent().hide();
                                        $('#DateTo').parent().hide();
                                        $("#AvailabilityDate").parent().hide();
                                }
                            });

                            $("#cf-submit").click(function () {

                                var address = $("#autocomplete").val();
                                var instructions = $("#instructions").val();
                                var vehicleType = $("#drpVehicleType").val();
                                var numOfSlot = $("#drpNumberOfSlot").val();
                                var availabilityType = $("#drpAvailabilityType").val();
                                var dateFrom = $("#DateFrom").val();
                                var dateTo = $("#DateTo").val();
                                var specificDate = $("#AvailabilityDate").val();
                                var sun = $("#Sun").prop("checked") == true;
                                var mon = $("#Mon").prop("checked") == true;
                                var tue = $("#Tue").prop("checked") == true;
                                var wed = $("#Wed").prop("checked") == true;
                                var thu = $("#Thu").prop("checked") == true;
                                var fri = $("#Fri").prop("checked") == true;
                                var sat = $("#Sat").prop("checked") == true;
                                var timeFrom = $("#drpTimeFrom").val();
                                var timeTo = $("#drpTimeTo").val();
                                var price = $("#price").val();
                                var lat = $("#lat").val();
                                var lng = $("#long").val();

                                var dataToSubmit = {
                                    Address: address,
                                    latitude: lat,
                                    longitude: lng,
                                    Instructions: instructions,
                                    VehicleType: vehicleType,
                                    NumberOfSlot: numOfSlot,
                                    AvailabilityType: availabilityType,
                                    Availability: {
                                        DateFrom: dateFrom,
                                        DateTo: dateTo,
                                        SpecificDate: specificDate,
                                        Sun: sun,
                                        Mon: mon,
                                        Tue: tue,
                                        Wed: wed,
                                        Thu: thu,
                                        Fri: fri,
                                        Sat: sat,
                                        TimeFrom: timeFrom,
                                        TimeTo: timeTo
                                    },
                                    Price: price
                                };

                                var photoData = new FormData();
                                var photo = $("#filePhoto").get(0).files;
                                if (photo.length > 0) {
                                    photoData.append("filePhoto", photo[0]);
                                }

                                if (!(/^\s*$/).test(address)) {
                                    if (!(/^\s*$/).test(lat)) {
                                        if (!(/^\s*$/).test(price)) {
                                            $.ajax({
                                                url: '@Url.Action("Post", "PostSpace")',
                                                data: dataToSubmit, //{ address: address, instructions: instructions},
                                                dataType: 'json',
                                                method: 'POST',
                                                success: function (result) {
                                                    if (photo.length > 0) {
                                                        photoData.append("Id", result.id);
                                                        $.ajax({
                                                            url: '@Url.Action("Photo","PostSpace")',
                                                            data: photoData,
                                                            method: 'POST',
                                                            processData: false,
                                                            contentType: false,
                                                            success: function () {
                                                                $(".alert-success").slideDown();
                                                                $(".alert-danger").hide();
                                                                $(".alert-danger").scrollTop();
                                                                $(".alert-success").slideDown("slow");
                                                                $("#autocomplete").val('');
                                                                $("#price").val('');
                                                                window.scrollTo(0, 0);
                                                            }
                                                        });
                                                    }
                                                    else {
                                                        $(".alert-success").slideDown();
                                                        $(".alert-danger").hide();
                                                        $(".alert-danger").scrollTop();
                                                        $(".alert-success").slideDown("slow");
                                                        $("#autocomplete").val('');
                                                        $("#price").val('');
                                                        window.scrollTo(0, 0);
                                                    }
                                                },
                                                error: function (xhr, error, errorThrown) {
                                                    $(".alert-success").hide();
                                                    $(".alert-danger").text(xhr.responseJSON.responseText);
                                                    $(".alert-danger").scrollTop();
                                                    $(".alert-danger").slideDown("slow");
                                                    window.scrollTo(0, 0);
                                                }
                                            });



                                        }
                                        else {
                                            $(".alert-danger").html("Invalid price.");
                                            $(".alert-success").hide();
                                            $(".alert-danger").offset().top;
                                            $(".alert-danger").slideDown("slow");
                                            window.scrollTo(0, 0);
                                        }
                                    }
                                    else {
                                        $(".alert-danger").html("Invalid address. Please select the appropriate address from the autocomplete dropdown.");
                                        $(".alert-danger").scrollTop();
                                        $(".alert-danger").slideDown("slow");
                                        $(".alert-success").hide();
                                        window.scrollTo(0, 0);
                                    }
                                }
                                else {
                                    $(".alert-danger").show();
                                    $(".alert-success").hide();
                                }
                            });

                            var map = null;

                            function initialize() {
                                var mapOptions = {
                                    center: { lat: -36.8436, lng: 174.7669182 },
                                    zoom: 15
                                };
                                map = new google.maps.Map(document.getElementById('map-canvas'),
                                    mapOptions);

                                var myLatlng = new google.maps.LatLng(-36.8436, 174.7669182);

                            }
                            //google.maps.event.addDomListener(window, 'load', initialize);



                            var placeSearch, autocomplete;
                            var componentForm = {
                                street_number: 'short_name',
                                route: 'long_name',
                                locality: 'long_name',
                                administrative_area_level_1: 'short_name',
                                country: 'long_name',
                                postal_code: 'short_name'
                            };

                            function initAutocomplete() {
                                // Create the autocomplete object, restricting the search to geographical
                                // location types.
                                autocomplete = new google.maps.places.Autocomplete(
                                    (document.getElementById('autocomplete')),
                                    { types: ['geocode'] });

                                // When the user selects an address from the dropdown, populate the address
                                // fields in the form.
                                autocomplete.addListener('place_changed', fillInAddress);
                            }

                            // [START region_fillform]
                            function fillInAddress() {
                                // Get the place details from the autocomplete object.
                                var place = autocomplete.getPlace();


                                $("#lat").val(place.geometry.location.G);
                                $("#long").val(place.geometry.location.K);
                                //map.setCenter(new google.maps.LatLng(place.geometry.location.G, place.geometry.location.K));

                                for (var component in componentForm) {
                                    document.getElementById(component).value = '';
                                    document.getElementById(component).disabled = false;
                                }

                                // Get each component of the address from the place details
                                // and fill the corresponding field on the form.
                                for (var i = 0; i < place.address_components.length; i++) {
                                    var addressType = place.address_components[i].types[0];
                                    if (componentForm[addressType]) {
                                        var val = place.address_components[i][componentForm[addressType]];
                                        document.getElementById(addressType).value = val;
                                    }
                                }
                            }
                            // [END region_fillform]

                            // [START region_geolocation]
                            // Bias the autocomplete object to the user's geographical location,
                            // as supplied by the browser's 'navigator.geolocation' object.
                            function geolocate() {
                                if (navigator.geolocation) {
                                    navigator.geolocation.getCurrentPosition(function (position) {
                                        var geolocation = {
                                            lat: position.coords.latitude,
                                            lng: position.coords.longitude
                                        };
                                        var circle = new google.maps.Circle({
                                            center: geolocation,
                                            radius: position.coords.accuracy
                                        });
                                        autocomplete.setBounds(circle.getBounds());
                                    });
                                }
                            }
                            // [END region_geolocation]



                        </script>
                    }

